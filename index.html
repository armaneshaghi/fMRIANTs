<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Fmriants</title>
  <meta name="description" content="Minimal fMRI pre-processing with ANTS">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Fmriants</h1>
    </header>
    <div id="container">
      <p class="tagline">Minimal fMRI pre-processing with ANTS</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/stnava/fMRIANTs/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/stnava/fMRIANTs/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/stnava/fMRIANTs" class="code">View Fmriants on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>
<a name="fmriants" class="anchor" href="#fmriants"><span class="octicon octicon-link"></span></a>fMRIANTs</h1>

<p>Minimal fMRI pre-processing with ANTS</p>

<pre><code>fmri=data/bold.nii.gz
nm=data/AFFINE
ref=${nm}_avg.nii.gz
antsMotionCorr -d 3 -a $fmri -o $ref
antsMotionCorr  -d 3 -o [ ${nm}, ${nm}.nii.gz,${nm}_avg.nii.gz] -m MI[${ref}, ${fmri}, 1 , 32 , Regular, 0.01  ] -t Affine[ 0.1 ] -u 1 -e 1 -s 1x0 -f 2x1 -i 3x0 -n 3  
#
# this is a 'fast' example - you should change -i 3x0 to something larger 
# and Regular, 0.01 to Regular, 0.2 for 'real' data - see AFFINE_AND_DEFORMABLE below
#
###########################################
### now do deformable motion correction ###
###########################################
nm=data/AFFINE_AND_DEFORMABLE
antsMotionCorr  -d 3 -o [ ${nm}, ${nm}.nii.gz,${nm}_avg.nii.gz] -m MI[${ref}, ${fmri}, 1 , 32 , Regular, 0.2  ] -t Affine[ 0.1 ] -u 1 -e 1 -s 1x0 -f 2x1 -i 33x20 -n 3  -m MI[${ref}, ${fmri}, 1 , 32 ] -t GaussianDisplacementField[0.15,3,0.5] -i 33x20 -u 1 -e 1 -s 1x0 -f 4x1 -n 3
</code></pre>

<p>The csv and result images that come out contain the motion corrected image and the motion nuisance variables - but you need to run the affine version to get the motion variables ( that's a small bug in that the 2nd level registration doesnt maintain the 1st level motion results ) .... It might be interesting to also write out the deformation field in order to quantify distortion but that is a separate issue.</p>

<p>Next you can run the CompCor command to estimate physiological nuisance variables.</p>

<pre><code># 
# CompCor needs a mask --- you can get the mask by (might need to alter the value 200 up or down) 
#
ThresholdImage 3  data/AFFINE_avg.nii.gz data/mask.nii.gz 200 1.e9 
ImageMath 3 data/mask.nii.gz ME data/mask.nii.gz 1 
ImageMath 3 data/mask.nii.gz GetLargestComponent data/mask.nii.gz
ImageMath 3 data/mask.nii.gz MD data/mask.nii.gz 2 
ImageMath 3 data/mask.nii.gz ME data/mask.nii.gz 1 
# you may alternatively run CompCor on the motion-corrected data
ImageMath 4 data/OUT.nii.gz CompCorrAuto data/bold.nii.gz data/mask.nii.gz 6 
#
# the important output will be called  OUT_compcorr.csv 
#
</code></pre>

<p>For T1 processing : see</p>

<p>(<a href="http://jeffduda.github.io/NeuroBattery/)%5BNeuroBattery%5D">http://jeffduda.github.io/NeuroBattery/)[NeuroBattery]</a></p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/stnava" class="avatar"><img src="https://0.gravatar.com/avatar/948c3f7aad7a55b0a53956aee8d25fce?d=https%3A%2F%2Fidenticons.github.com%2F7a7b65b4103ecd3659e65ecc8193851c.png&amp;r=x&amp;s=60" width="48" height="48"/></a> <a href="https://github.com/stnava">stnava</a> maintains <a href="https://github.com/stnava/fMRIANTs">Fmriants</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/stnava/fMRIANTs/tarball/master" class="tar">tar</a><a href="https://github.com/stnava/fMRIANTs/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
